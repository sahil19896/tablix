!function(){"use strict";frappe.provide("tablix.gps.utils");var e=[];$.extend(tablix.gps.utils,{get_current_location:function(e){var t=e.options?e.options:tablix.gps.utils.get_default_args();navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){if(!e.callback)return t;e.callback(t)},tablix.gps.utils.current_location_error,t):console.log(__("Geo location is not supported in your browser"))},watch_location:function(t){var i=t.options?t.options:tablix.gps.utils.get_default_args();navigator.geolocation?(tablix.gps.utils.clear_watch_list(),w_id=navigator.geolocation.watchPosition(function(e){if(!t.callback)return e;t.callback(e)},tablix.gps.utils.current_location_error,i),e.push(w_id)):console.log(__("Geo location is not supported in your browser"))},clear_watch_list:function(){console.log(e);for(var t=0;t<e.length;t++)navigator.geolocation.clearWatch(e[t])},get_default_args:function(){return{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}},current_location_error:function(e){frappe.msgprint(__("Error while getting location")),console.log(e)},helper_function:function(e){e=e.coords;$.extend(e,frappe.user_info()),frappe.call({method:"tablix.whitelisted.gps_location",args:e,callback:function(e){console.log(e)}})},load_safe_google_map:function(e){e.callback;if(!frappe.boot.tablix.geo.__map_loaded){var t=document.createElement("script");t.src=format("https://maps.googleapis.com/maps/api/js?key={0}&callback={1}",[frappe.boot.tablix.geo.google_api_key,"load_map"]),$(t).appendTo("head")}}}),frappe.provide("tablix.gps"),tablix.gps.make_page=function(e){if(tablix.gps[e.cls_name])return new tablix.gps[e.cls_name](e);console.error(__("Invalid Class Name"))},tablix.gps.Dashboard=frappe.ui.Page.extend({init:function(){this.set_document_title=!0,this.buttons={},this.fields_dict={},this.views={},this.make(),frappe.ui.pages[frappe.get_route_str()]=this},make:function(){this._super(),this.render_template(),this.init_filters()},add_main_section:function(){$(frappe.render_template("tablix_page",{title:__(this.title)})).appendTo($("#body_div")),this.single_column?this.add_view("main",'<div class="row layout-main">                                        <div class="col-md-12 layout-main-section-wrapper">                                                <div class="layout-main-section"></div>                                                <div class="layout-footer hide"></div>                                        </div>                                </div>'):this.add_view("main",'<div class="row layout-main">                                <div class="col-md-12 layout-main-section-wrapper">                                        <div class="layout-main-section"></div>                                        <div class="layout-footer hide"></div>                                </div>                        </div>'),this.setup_page()},init_filters:function(){this.include_filters&&(this.tablix_filters=new tablix.gps.Filters(this.args)),window.form=this},render_template:function(){if(this.template){var e=this.template.args?this.template.args:{},t=this.template.name;$(frappe.render_template(t,e)).appendTo($(".tablix-page"))}}}),frappe.provide("tablix.geolocation"),tablix.geolocation.Location=Class.extend({init:function(e){$.extend(this,e),this.map=null,this.markers=[],this.info_windows=[],this.current_location=null,this.make()},make:function(){this.set_field(),this.init_div(),this.load_google_map()},set_field:function(){this.map_field||(this.map_field=this.frm.get_field("google_map"),this.$wrapper=this.map_field.$wrapper)},create_search_field:function(){if(!this.is_searchable)return!1;var e=this;if(1==this.frm.doc.docstatus||!e.map)return!1;this.map_search||(e.search_input="<input id='google-map-search' class='form-control' type='text' placeholder='Search Box'>",e.$wrapper.prepend(this.search_input),e.ele=document.getElementById("google-map-search"),e.search_box=new google.maps.places.SearchBox(this.ele),e.map.controls[google.maps.ControlPosition.TOP_LEFT].push(this.ele),e.map.addListener("bounds_change",function(){e.search_box.setBounds(map.getBounds())}),e.search_box.addListener("places_changed",function(){e.handle_places()}))},handle_places:function(){if(places=this.search_box.getPlaces(),!places)return frappe.msgprint("Select location has no coordinates"),!1;place=places[0],args={},$.extend(args,{latitude:place.geometry.location.lat(),longitude:place.geometry.location.lng(),location_name:place.name,place_id:place.place_id}),this.draw_marker(args),this.callback&&this.callback(place)},init_div:function(){this.map_div="<div class='container'>\n\t\t\t\t\t<div class='row'>\n\t\t\t\t\t\t<div id='google-map' style='width:100%; height:500px;' ></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>",this.$wrapper.append(this.map_div)},load_google_map:function(){_frm=cur_frm,load_map=this.create_map,window.google.maps||(ele=document.createElement("script"),lib="libraries=places",url="https://maps.googleapis.com/maps/api/js?key={0}&callback=load_map&{1}",ele.src=format(url,[frappe.boot.tablix.geo.google_api_key,lib]),$(ele).appendTo("head"))},create_map:function(e){if(console.log(e),ele=document.getElementById("google-map"),options={},1==!_frm.doc.__islocal){if(locations=_frm.doc.locations,!locations||0==locations.length||null==locations)return _frm.cscript.setup_default_location(),!1;for(var t=0;t<locations.length;t++){var i=locations[t];0==t?(options={center:{lat:flt(i.latitude),lng:flt(i.longitude)},zoom:1},_frm.map=new google.maps.Map(ele,options),_frm.cscript.draw_marker(i)):_frm.cscript.draw_marker(i)}_frm.cscript.create_search_field()}else _frm.cscript.setup_default_location()},draw_marker:function(e){this.map||(this.frm.map?this.map=this.frm.map:this.frm.map&&this.map||(ele=document.getElementById("google-map"),this.map=new google.maps.Map(ele,{})));var t=this,i=e.location_name?e.location_name:"No Address found",a=new google.maps.Marker({position:{lat:flt(e.latitude),lng:flt(e.longitude)},map:t.map,title:i}),l=new google.maps.InfoWindow({content:i||"No Info"});a.addListener("click",function(){l.open(t.map,a)});var o=new google.maps.LatLng(flt(e.latitude),flt(e.longitude)),s=new google.maps.LatLngBounds;this.markers.push(a),this.info_windows.push(l),s.extend(o),t.map.fitBounds(s)},clear_markers:function(){this.markers&&$.each(this.markers,function(e,t){t.setMap(null)})},load_current_location:function(e){this.draw_marker(e),this.search_box||this.create_search_field()},setup_default_location:function(){var e={};return this.default_location&&1!=this.frm.doc.__islocal?$.extend(e,{latitude:this.default_location.latitude,longitude:this.default_location.longitude,location_name:this.default_location.location_name}):$.extend(e,{latitude:frappe.boot.tablix.geo.latitude,longitude:frappe.boot.tablix.geo.longitude,location_name:frappe.boot.tablix.geo.location_name}),_frm.cscript.draw_marker(e),_frm.cscript.create_search_field(),!1}}),frappe.provide("tablix.gps"),tablix.gps.Grid=Class.extend({init:function(e){$.extend(this,e),this.make()},make:function(){this.config()},config:function(){var e={fields:this.fields,data:this.data,autoload:!1,controller:{loadData:$.noop,insertItem:$.noop,updateItem:$.noop,deleteItem:$.noop},width:"auto",height:"auto",heading:!0,filtering:!1,inserting:!1,editing:!1,selecting:!0,sorting:!1,paging:!1,pageLoading:!1,rowClass:function(e,t){},rowClick:function(e){},rowDoubleClick:function(e){},noDataContent:"Not found",confirmDeleting:!0,deleteConfirm:"Are you sure?",pagerContainer:null,pageIndex:1,pageSize:20,pageButtonCount:15,pagerFormat:"Pages: {first} {prev} {pages} {next} {last}    {pageIndex} of {pageCount}",pagePrevText:"Prev",pageNextText:"Next",pageFirstText:"First",pageLastText:"Last",pageNavigatorNextText:"...",pageNavigatorPrevText:"...",invalidNotify:function(e){},invalidMessage:"Invalid data entered!",loadIndication:!0,loadIndicationDelay:500,loadMessage:"Please, wait...",loadShading:!0,updateOnResize:!0,rowRenderer:null,headerRowRenderer:null,filterRowRenderer:null,insertRowRenderer:null,editRowRenderer:null};this.grid=$(this.cls_name).jsGrid(e)}}),tablix.gps.LoadTask=Class.extend({init:function(e){$.extend(this,e),this.args=e,this._super()},make:function(e){this._super()},get_data:function(){}}),frappe.provide("tablix.gps"),tablix.gps.Filters=Class.extend({init:function(e){$.extend(this,e),this.fields_dict={},this.make()},make:function(){this.init_filters()},init_filters:function(){this.fields=[],this.filters=this.filters?this.filters:[];var e=this;$.each(e.filters,function(t,i){cls_name=format(".{0}",[i.cls_name]),field=new frappe.ui.form.make_control({df:{fieldname:i.fieldname,fieldtype:i.fieldtype,default:i.default,options:i.options?i.options:null,placeholder:i.placeholder},parent:$.find(cls_name),only_input:!0}),field.make_input(),e.fields.push(field),e.filters.length-1==t&&e.update_link_field(),e.fields_dict[field.df.fieldname]=field})},get_values:function(){values={};for(var e=0;e<this.fields.length;e++)temp=this.fields[e],values[temp.df.fieldname]=temp.$input.val();return values},update_link_field:function(){$(".link-field").removeAttr("style")},validate_mandatory:function(){for(var e="",t=0;t<this.fields.length;t++)temp=this.fields[0],1!=temp.df.reqd||temp.$input.val()&&""!=temp.$input.val()||(msg=format(" {0} ",[temp.df.label||temp.df.fieldname]),e+=msg);return this.reqd=!1,""==e||(this.reqd=!0,msg=format("Please enter mandatory fields {0} ",[msg]),frappe.msgprint(__(msg)),!1)},get_field:function(e){return!!this.fields_dict.hasOwnProperty(e)&&this.fields_dict[e]}}),frappe.provide("tablix.gps"),tablix.gps.ClockAttendance=tablix.gps.Dashboard.extend({init:function(e){$.extend(this,e),this.args=e,this._super()},make:function(){this._super(),this.handler()},handler:function(){var e=this;$("#dashboard-search").on("click",function(t){if(flag=e.tablix_filters.validate_mandatory(),!flag)return!1;values=e.tablix_filters.get_values(),frappe.call({method:"tablix.whitelisted.clock_in_clock_out_report",args:values,callback:function(e){console.log(e)}})})},draw_clock_in:function(){},draw_clock_out:function(){}}),frappe.provide("tablix.gps"),tablix.gps.GoogleMap=Class.extend({init:function(e){$.extend(this,e),$("#"+this.map_id).empty(),this.make()},make:function(){this.map_div=document.getElementById(this.map_id),this.markers=[],this.info_windows=[],this.init_map()},init_map:function(){this.default_location?this.display_default_location():(this.display_locations(null),this.display_user_info())},display_locations:function(e){this.default_location&&(e=e.coords);var t=e?[e]:this.message.results;this.map=new google.maps.Map(this.map_div,{zoom:18}),this.create_markers(t)},create_markers:function(e){var t=this;$.each(e,function(e,i){var a={position:{lat:flt(i.latitude),lng:flt(i.longitude)},map:t.map,title:i.detail?i.detail:"Current Location"};marker=new google.maps.Marker(a),t.set_info_window(marker,i),t.markers.push(marker)}),temp=e.length>=1?e[0]:null,temp&&(latlng=new google.maps.LatLng({lat:flt(temp.latitude),lng:flt(temp.longitude)}),this.map.setCenter(latlng))},display_default_location:function(){var e={},t=this;e.callback=function(e){t.display_locations(e)},tablix.gps.utils.get_current_location(e)},display_user_info:function(){$(".user-emp-info").empty(),this.default_location||$(frappe.render_template("user_info",{user_info:this.message.user_info,emp_info:this.message.emp_info})).appendTo($(".user-emp-info"))},set_info_window:function(e,t){me=this;var i=new google.maps.InfoWindow({content:t.detail});e.addListener("click",function(){i.open(me.map,e)})}}),frappe.templates.tablix_page='<div class="tablix-page-header">  <div class="row">   <div class="col-lg-12 text-center">    <h1 class="tablix-page-title "> {{ title }}</h1>    </div>  </div>   </div> <div class="fluid-container">  <div class="tablix-page">  </div> </div> ',frappe.templates.employee_location='<div class="tablix-filters">   <div class="filters">  <div class="row">   <div class="col-lg-3">    <div class="">     <label class="For Employee tablix-color"> Employee </label>     <div class="gps-employee">     </div>    </div>   </div>   <div class="col-lg-3">    <div class="form-group">     <label class="For Type tablix-color"> Type </label>     <div class="gps-type"></div>    </div>   </div>   <div class="col-lg-3">    <div class="form-group">     <label class="For From Datetime tablix-color"> From Datetime </label>     <div class="gps-from-datetime"></div>    </div>   </div>   <div class="col-lg-3">    <div class="form-group">     <label class="For To Datetime tablix-color"> To Datetime </label>     <div class="gps-to-datetime"></div>    </div>   </div>  </div>    </div>   <div class="row">  <div class="col-lg-3"></div>  <div class="col-lg-3"></div>  <div class="col-lg-5"></div>  <div class="col-lg-1">      <div class="form-group">    <button  class="form-control tablix-btn"  id="dashboard-search"> {{ __("Search") }}</button>   </div>  </div>   </div>   <div class="row">  <div class="tablix-page-container">   <div class="gps-google-map tablix-border-color" id="gps_google_map" style="width:100%; height:600px;;">   </div>   <div class="user-emp-info" id="user_emp_info"></div>  </div>    </div> </div> ',frappe.templates.user_info='<div class="row" style="margin-top:100px;">  <div class="col-lg-12 tablix-info-div">   <h1 style="color:#0184A4" class="text-center"> USER INFO</h1>    <div class="col-lg-6">     <div class="col-lg-12">     <strong>{{ __("Employee Name: ") }} </strong>{{ ("Test") }}    </div>    <div class="col-lg-12">     <strong>{{ __("Employee ID: ") }}</strong> {{ emp_info.employee }}    </div>    <div class="col-lg-12">      <strong>{{ __("Gender: ") }}</strong> {{ emp_info.gender }}    </div>    <div class="col-lg-12">     <strong>{{ __("Designation: ") }} </strong> {{ emp_info.designation }}    </div>    <div class="col-lg-12">     <strong>{{ __("Username: ") }}</strong> {{ user_info.first_name }}    </div>    <div class="col-lg-12">     <strong>{{ __("Email: ") }}</strong> {{ user_info.email }}    </div>   </div>   <div class="col-lg-6">    <div class="col-lg-12">     <img src="{{ emp_info.image }}" class="user-image" alt="User Image">    </div>   </div>   </div>  </div> </div> ',frappe.templates.clock_attendance='<div class="tablix-filters">   <div class="filters">  <div class="row">   <div class="col-lg-2">    <div class="form-group">     <label class="tablix-color For Timesheet"> Select Employee </label>     <div class="clock-employee">     </div>    </div>   </div>   <div class="col-lg-2">    <div class="form-group">     <label class="tablix-color For Timesheet"> Select Project </label>     <div class="clock-project">     </div>    </div>   </div>   <div class="col-lg-2">    <div class="form-group">     <label class="tablix-color For Task"> Select Task </label>     <div class="clock-task"></div>    </div>   </div>   <div class="col-lg-2">    <div class="form-group">     <label class="tablix-color For Site"> Select Site </label>     <div class="clock-sitename"></div>    </div>   </div>   <div class="col-lg-2">    <div class="form-group">     <label class="tablix-color For Timesheet"> Select From Datetime </label>     <div class="clock-from-datetime">     </div>    </div>   </div>   <div class="col-lg-2">    <div class="form-group">     <label class="tablix-color For Timesheet"> Select To Datetime</label>     <div class="clock-to-datetime">     </div>    </div>   </div>   </div>    </div>   <div class="row">  <div class="col-lg-3"></div>  <div class="col-lg-3"></div>  <div class="col-lg-5"></div>  <div class="col-lg-1">      <div class="form-group">    <button  class="form-control tablix-btn"  id="dashboard-search"> {{ __("Search") }}</button>   </div>  </div>   </div>   <div class="row">  <div class="tablix-page-container">   <div class="col-lg-12 text-center">    <h1> YEARLY REPORT</h1>    <div class="tablix-border-color clock-yearly" id="clock-yearly"></div>   </div>   <div class="col-lg-12 text-center">    <h1> QUARTERLY REPORT</h1>    <div class="tablix-border-color clock-quarterly" id="clock-quarterly"></div>   </div>   <div class="col-lg-12 text-center">    <h1>MONTHLY REPORT</h1>    <div class="tablix-border-color clock-monthly" id="clock-monthly"></div>   </div>   <div class="col-lg-12 text-center">    <h1> TASK WISE DETAILS</h1>    <div class="tablix-border-colr clock-tasks-detail" id="clock-tasks-detail"></div>   </div>  </div>    </div> </div> '}();
//# sourceMappingURL=geolocation-min.js.map
